{% extends "layout.html" %}
{% block content %}

<div class="row g-3 mb-3">
  <div class="col-12">
    <div class="card shadow-sm pt-card">
      <div class="card-body d-flex flex-wrap justify-content-between align-items-center">
        <div>
          <h1 class="h4 mb-1 text-white">Network Overview</h1>
          <div class="text-white-50">Window: <code>{{ start_iso }}</code> â†’ <code>{{ end_iso }}</code></div>
        </div>
        <div class="d-flex gap-3 mt-3 mt-md-0">
          <div class="pt-metric bg-blue text-white">
            <div class="label">Good Traffic</div>
            <div class="value">{{ good_packets }}</div>
          </div>
          <div class="pt-metric bg-red text-white">
            <div class="label">Pending Warnings</div>
            <div class="value">{{ total_alerts }}</div>
          </div>
          <div class="pt-metric bg-dark text-white">
            <div class="label">Flagged Hosts</div>
            <div class="value">{{ hosts_flagged }}</div>
          </div>
          <div class="pt-metric bg-secondary text-white">
            <div class="label">Packets Seen</div>
            <div class="value">{{ total_packets }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row g-3">
  <div class="col-lg-7">
    <div class="card shadow-sm">
      <div class="card-body">
        <h2 class="h6 mb-2">Traffic Volume (packets / minute)</h2>
        <canvas id="pktsChart"></canvas>
      </div>
    </div>
  </div>
  <div class="col-lg-5">
    <div class="card shadow-sm mb-3">
      <div class="card-body">
        <h2 class="h6 mb-2">Alert Frequency (by type)</h2>
        <canvas id="alertsChart"></canvas>
      </div>
    </div>
    <div class="card shadow-sm">
      <div class="card-body">
        <h2 class="h6 mb-2">Protocol Breakdown</h2>
        <canvas id="protoChart"></canvas>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
const pktLabels = {{ packet_labels|tojson }};
const pktCounts = {{ packet_counts|tojson }};
const alertTypes = {{ alert_types|tojson }};
const alertValues = {{ alert_values|tojson }};
const protoLabels = {{ proto_labels|tojson }};
const protoValues = {{ proto_values|tojson }};

new Chart(document.getElementById('pktsChart'), {
  type: 'line',
  data: { labels: pktLabels, datasets: [{ label: 'Packets/min', data: pktCounts, tension: 0.2 }]},
  options: { scales: { x: { ticks: { maxTicksLimit: 8 }}}}
});

new Chart(document.getElementById('alertsChart'), {
  type: 'bar',
  data: { labels: alertTypes, datasets: [{ label: 'Alerts', data: alertValues }]},
  options: { plugins: { legend: { display: false }}}
});

new Chart(document.getElementById('protoChart'), {
  type: 'doughnut',
  data: { labels: protoLabels, datasets: [{ data: protoValues }]},
  options: { plugins: { legend: { position: 'bottom' }}}
});
</script>
{% endblock %}

